require 'nokogiri'
require_relative '../../../lib/spscan/xml_vulnerability_source'
require_relative '../../../lib/spscan/vulnerability'

module SpScan
    describe XmlVulnerabilitySource do
      
      it "gets the vulnerabilities for a given version" do

        fixture_file = File.dirname(__FILE__) + '/../../fixtures/vulns_fixture.xml'
        source = XmlVulnerabilitySource.new(fixture_file)
        version = double("version")
        version.stub(:identifier).and_return("FixtureVersion")

        vulns = source.vulnerabilities_for version
        vulns.length.should == 1

        vuln = vulns[0]
        vuln.title.should == "All your base are belong to us."
        vuln.references[0].should == "https://en.wikipedia.org/wiki/All_your_base_are_belong_to_us"
        vuln.type.should == "Other"
      end
    end
end
